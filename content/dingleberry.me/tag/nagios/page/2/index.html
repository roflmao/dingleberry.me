<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">


<!-- Mirrored from dingleberry.me/tag/nagios/page/2/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 28 Jul 2020 09:31:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta name="verify-v1" content="2rXzy+cQDUSahcuL4FvfXvDHZf0neGFXRtWQjgvNFSg=" />
<meta name="verify-v1" content="cAY9vxAYMdRz6Fqo2XC7yBXodW8+0qyJVN+Jm4NaCjs=" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />

<title>nagios | dingleberry.me - Part 2</title>

<link rel="stylesheet" type="text/css" href="../../../../wp-content/themes/quadstripe/style.css" />

<link rel="stylesheet" type="text/css" href="../../../../wp-content/themes/quadstripe/blue.css" />



<link rel="alternate" type="application/rss+xml" title="dingleberry.me RSS Feed" href="../../../../feed/index.html" />

<link rel="pingback" href="../../../../xmlrpc.php" />



<link rel="alternate" type="application/rss+xml" title="dingleberry.me &raquo; nagios Tag Feed" href="../../feed/index.html" />
<link rel='stylesheet' id='shadowbox-css-css'  href='../../../../wp-content/uploads/shadowbox-js/src/shadowbox19ce.css?ver=3.0.3' type='text/css' media='screen' />
<link rel='stylesheet' id='shadowbox-extras-css'  href='../../../../wp-content/plugins/shadowbox-js/css/extrasc393.css?ver=3.0.3.10' type='text/css' media='screen' />
<link rel='stylesheet' id='sociablecss-css'  href='../../../../wp-content/plugins/sociable/css/sociable7e2e.css?ver=3.8.1' type='text/css' media='all' />
<link rel='stylesheet' id='quotescollection-style-css'  href='../../../../wp-content/plugins/quotes-collection/quotes-collection00e2.css?ver=1.5.7' type='text/css' media='all' />
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery3e5a.js?ver=1.10.2'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var QCAjax = {"ajaxurl":"http:\/\/dingleberry.me\/wp-admin\/admin-ajax.php","nonce":"413e2c4400","nextquote":"Next quote\u00a0\u00bb","loading":"Loading...","error":"Error getting quote","auto_refresh_max":"30","auto_refresh_count":"0"};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/quotes-collection/quotes-collection00e2.js?ver=1.5.7'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/sociable/js/sociable7e2e.js?ver=3.8.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/sociable/js/vuible7e2e.js?ver=3.8.1'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/sociable/js/addtofavorites7e2e.js?ver=3.8.1'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery.form.min018d.js?ver=3.37.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPWallSettings = {"refreshtime":"0","expand_box":""};
/* ]]> */
</script>
<script type='text/javascript' src='../../../../wp-content/plugins/wp-wall/wp-wall7e2e.js?ver=3.8.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc0db0.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 3.8.1" />
<!-- HeadSpace SEO 3.6.41 by John Godley - urbangiraffe.com -->
<meta name="description" content="technical blog about technical stuff for sysadmins etc" />
<meta name="keywords" content="nagios dashboard bigip f5 varnish munin debian lisa curl linux sysadmin" />
<!-- HeadSpace -->
<script type='text/javascript'>var base_url_sociable = 'http://dingleberry.me/wp-content/plugins/sociable/'</script><script type='text/javascript' src='http://apis.google.com/js/plusone.js'></script><link rel="stylesheet" href="../../../../wp-content/plugins/wp-wall/wp-wall.css" type="text/css" />
<!-- All in One SEO Pack 2.1.3 by Michael Torbert of Semper Fi Web Design[410,484] -->
<link rel='prev' href='../../index.html' />

<link rel="canonical" href="index.html" />
<!-- /all in one seo pack -->

</head>



<body>



   <!-- Begin Wrapper -->

   <div id="wrapper">

   

         <!-- Begin Header -->

         <div id="header">

		 

		       <h1><a href="../../../../index.html">dingleberry.me</a></h1>

				<div class="description">technical blog shit</div>

			   

		 </div>

		 <!-- End Header -->

		 

		 <!-- Begin Navigation -->

		 <div id="navigation">

		 

		       <ul>

			   <li><a href="../../../../index.html">Home</a></li>

			<li class="page_item page-item-2"><a href="../../../../about/index.html">About Us</a></li>

				</ul>

		 </div>
		 <!-- End Navigation -->

<br/>
<script type="text/javascript"><!--
google_ad_client = "pub-0660223234642083";
/* 728x90, created 11/9/09 */
google_ad_slot = "8516937673";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


		 

		 <!-- Begin Content -->

		 <div id="content">

		 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/07/ideas-of-cmdb-cfengine-and-nagios-integration/index.html" rel="bookmark" title="Permanent Link to Ideas of CMDB, cfengine and nagios integration">Ideas of CMDB, cfengine and nagios integration</a></h2>



<div class="post-info">Posted July 3, 2009 by morten</div>

			   

			   <p>For a while we’ve been discussing how we can become as lazy as possible when it comes to systemadministration, and this time we’ve made a quite neat integration between our homemade CMDB, cfengine and nagios.</p>
<p>Here’s the idea:</p>
<p>First of all, nobody likes to manually update a CMDB. Also its never really possible to maintain it in a way that makes its info become obsolete after some time. This is why we made a script, cfcmdb, that is triggered from cfengine on every host. This script fills the CMDB database with all sort of info from tools like dmidecode and also from standard commandline tools. (Memory, networkingcards, os version, cpu, vendor etc etc). So now our CMDB pretty much keeps itself up to date.</p>
<p>Lately we came up with the idea to fill our CMDB with cfengine classes information. So adding to the cfcmdb script mentioned above :</p>
<p>cfagent –no-splay -p -v | grep Defined</p>
<p>..and a little perl split and join, we now have all the classes in our CMDB bount to hostid’s.</p>
<p>Cool. On our nagios-server, we made another script, cmdb2nagios, which takes the parameters “hosts”, “hostgroups” or “services”.</p>
<p>cmdb2nagios hosts : creates the nagios host-config file</p>
<p>cmdb2nagios hostgroups : creates the nagios hostgroup-config file</p>
<p>cmdb2nagios services : creates the servicefile</p>
<p>The services parsing is quite nice now, cause we can automatically monitor any services set up with cfengine. Lets say we have a bunch of hosts installed with cfengine and cfengine tells them to have apache2 running. That means that this will be part of a cfengine class, that will be available in our CMDB.</p>
<p>Example of cmdb2nagios service parsing :</p>
<p>[snip]</p>
<p>$sql = “select hosts.name from hosts,classes where classes.name = ‘class_apache’ and hosts.hostid = classes.hostid”;<br />
$execute = $connect-&gt;query($sql) or die “wtf? it didnt work …check syntax.”;<br />
my @servicehosts;<br />
while (@results = $execute-&gt;fetchrow()) {<br />
push(@servicehosts, $results[0]);<br />
}</p>
<p>$hosts = join(”,”,@servicehosts);<br />
print “define service{\n”;<br />
print “\tuse\t\t\tgeneric-service\n”;<br />
print “\thost_name\t\t” . $hosts . “\n”;<br />
print “\tservice_description\tcfg_CHECK_APACHE\n”;<br />
print “\tis_volatile\t\t0\n”;<br />
print “\tmax_check_attempts\t1\n”;<br />
print “\tnormal_check_interval\t5\n”;<br />
print “\tretry_check_interval\t1\n”;<br />
print “\tcontact_groups\t\tlinux-admins\n”;<br />
print “\tnotification_period\t24×7\n”;<br />
print “\tnotification_options\tc,w,r\n”;<br />
print “\tprocess_perf_data\t1\n”;<br />
print “\tcheck_command\t\tcheck_apache\n”;<br />
print “\t}\n\n”;<br />
[snip]</p>
<p>As you can see, monitoring apache will be applied to all hosts running apache.</p>
<p>This leaves us to really only having to  maintain our cfengine configuration, while the CMDB is auto-updated and the nagios-config is auto-parsed.</p>
<p>Also our eventhandlers in nagios tells cfengine to do this and that, so now we can sit back, enjoy a coffee and watch this show.</p>
<p>(see previous post about eventhandlers and cfengine : http://www.sladder.org/?p=261)</p>



<p>Tags: <a href="../../../cfengine/index.html" rel="tag">cfengine</a>, <a href="../../../cmdb/index.html" rel="tag">cmdb</a>, <a href="../../index.html" rel="tag">nagios</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/07/ideas-of-cmdb-cfengine-and-nagios-integration/index.html#comments">No Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/03/nagios-plugins-and-check_http-version-1412/index.html" rel="bookmark" title="Permanent Link to nagios-plugins and check_http version 1.4.12">nagios-plugins and check_http version 1.4.12</a></h2>



<div class="post-info">Posted March 6, 2009 by morten</div>

			   

			   <p>Yes, it&#8217;s broken! I found out today after moving to a new nagios-server. My old http checks did not work, they only resulted in WARNINGS. Seems this is a redirect problem in check_http. It is fixed in the latest version.<br />
I did not have time to go trough all the plugins this evening (friday and all) so I simply downloaded the latest tar.gz pluginpack from nagios.org, extracted it, ran &#8220;./configure&#8221; and then make all. After that I just moved the check_http from the freshly compiled plugin folder to my nagios plugins folder. Problem solved. 1.4.13 works fine.</p>



<p>Tags: <a href="../../../check_http/index.html" rel="tag">check_http</a>, <a href="../../index.html" rel="tag">nagios</a>, <a href="../../../plugins/index.html" rel="tag">plugins</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/03/nagios-plugins-and-check_http-version-1412/index.html#comments">No Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/02/a-quick-note-about-the-nagios-check_procs-plugin/index.html" rel="bookmark" title="Permanent Link to A quick note about the Nagios check_procs plugin">A quick note about the Nagios check_procs plugin</a></h2>



<div class="post-info">Posted February 24, 2009 by morten</div>

			   

			   <p>I had an issue today where <code>check_procs</code> returned &#8220;0 processes with command name &#8216;some-process-name&#8217; &#8220;. When I did a <code>ps -ef | grep some-process-name</code> I could see the process running, so I was like &#8220;wtf?!&#8221;, but then a collegue told me he had seen this before. Seems the <code>check_procs</code> uses something like <code>ps -cA</code> to check for running-processes and using those parameters, you only see part of the process name, so while it wouldnt match &#8220;some-process-name&#8221; it would match &#8220;some-process-n&#8221;. So if you wonder why it returns 0 processes, do a <code>ps -cA</code> to find the right process name to match in your config.</p>



<p>Tags: <a href="../../../check_procs/index.html" rel="tag">check_procs</a>, <a href="../../../monitoring/index.html" rel="tag">monitoring</a>, <a href="../../index.html" rel="tag">nagios</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/02/a-quick-note-about-the-nagios-check_procs-plugin/index.html#comments">2 Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/02/monitoring-web-apps-using-html-forms-for-logging-in/index.html" rel="bookmark" title="Permanent Link to Monitoring web apps using html forms for logging in">Monitoring web apps using html forms for logging in</a></h2>



<div class="post-info">Posted February 18, 2009 by morten</div>

			   

			   <p>Several times I&#8217;ve wanted to monitor if login actually works on webapplications that uses html forms for user validation. Today I made a simple bash nagios plugin to do that. It uses curl and checks it&#8217;s output. Curl supports POST variables.<br />
The plugin also checks the unixtime before and after the curl command is being run, then does and expr to find the diff and makes nagios performance data of it.</p>
<p>Feel free to copy paste the code and use it for your own purpose.</p>
<p><code>#!/bin/sh<br />
#my %ERRORS=('OK'=&amp;gt;0,'WARNING'=&amp;gt;1,'CRITICAL'=&amp;gt;2,'UNKNOWN'=&amp;gt;3,'DEPENDENT'=&amp;gt;4);<br />
#This is what we get after a successful login<br />
MATCH="bladiblah successful login bladiblah"<br />
#delete the tmp file before writing a new one<br />
rm /tmp/login_check<br />
#Grab the unixtime before the command runs<br />
BEFORE=`date +%s`<br />
#Login to the app<br />
/usr/bin/curl -H "host: example.com" -F mail="mail@example.com" -F userPassword="fail" http://111.111.111.111 -o /tmp/login_check &amp;gt; /dev/null 2&amp;gt;&amp;amp;1<br />
#Grab the unixtime after the command have been run<br />
AFTER=`date +%s`<br />
DIFF=`/usr/bin/expr $AFTER - $BEFORE`<br />
#Check tmp file if it matches our successful login<br />
CHECK=`grep "$MATCH" /tmp/login_check`<br />
if [ "$CHECK" = "$MATCH" ]; then<br />
#WIN!!<br />
echo "OK. Login successful. | response=$DIFF"<br />
exit 0<br />
else<br />
#FAIL!!<br />
echo "CRITICAL. Login failed."<br />
exit 2<br />
</code></p>
<p>And as always, sorry about the wordpress formating of the code.</p>



<p>Tags: <a href="../../../authentication/index.html" rel="tag">authentication</a>, <a href="../../../forms/index.html" rel="tag">forms</a>, <a href="../../../html/index.html" rel="tag">html</a>, <a href="../../../login/index.html" rel="tag">login</a>, <a href="../../../monitoring/index.html" rel="tag">monitoring</a>, <a href="../../index.html" rel="tag">nagios</a>, <a href="../../../post/index.html" rel="tag">post</a>, <a href="../../../variables/index.html" rel="tag">variables</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/02/monitoring-web-apps-using-html-forms-for-logging-in/index.html#comments">2 Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/01/monitoring-dell-hardware-in-nagios-on-the-debian-etch-64bit-platform/index.html" rel="bookmark" title="Permanent Link to Monitoring Dell hardware in Nagios on the Debian Etch 64bit Platform">Monitoring Dell hardware in Nagios on the Debian Etch 64bit Platform</a></h2>



<div class="post-info">Posted January 29, 2009 by morten</div>

			   

			   <p>Getting Dell&#8217;s linux-software to work on other platforms than Redhat can be a bitch, but I was lucky to come across <a href="http://blog.zztopping.com/2008/04/29/dell-omsa-debian-64bit/">this</a> article. Following those steps I had dellomsa up and running a couple of minutes later.<br />
Then I went to <a href="http://www.nagiosexchange.org/">nagiosexchange</a> and downloaded the perl script <a href="http://www.nagiosexchange.org/cgi-bin/page.cgi?g=1923.html;d=1">check_dell_sensors.pl</a>.</p>
<p>In this case I use check_by_ssh to run the check on each host, so here&#8217;s the <strong>command.cfg</strong> setup</p>
<p><code>define command{<br />
command_name    check_dell_sensors<br />
command_line    $USER1$/check_by_ssh -l someuser -t 30 -H $HOSTADDRESS$ -C "/usr/lib/nagios/plugins/check_dell_sensors.pl"<br />
}<br />
</code></p>
<p>and finally the <strong>services.cfg</strong></p>
<p><code><br />
define service{<br />
use                             generic-service<br />
hostgroup_name                  cfg_CHECK_DELL_SENSORS<br />
service_description             CHECK_DELL_SENSORS<br />
is_volatile                     0<br />
max_check_attempts              3<br />
normal_check_interval           5<br />
retry_check_interval            1<br />
contact_groups                  linux-admins<br />
notification_period             24x7<br />
notification_options            c,w,r<br />
check_command                   check_dell_sensors<br />
}<br />
</code></p>
<p>This will monitor your dell hardware on all hosts in your cfg_CHECK_DELL_SENSORS hostgroup, giving you an output like :<br />
<code>/usr/lib/nagios/plugins/check_dell_sensors.pl<br />
OK -- Hardware Log=Ok; Memory=Ok; Power Supplies=Ok; Processors=Ok; Temperatures=Ok; Voltages=Ok;</code></p>



<p>Tags: <a href="../../../dell/index.html" rel="tag">dell</a>, <a href="../../../hardware/index.html" rel="tag">hardware</a>, <a href="../../../monitoring/index.html" rel="tag">monitoring</a>, <a href="../../index.html" rel="tag">nagios</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/01/monitoring-dell-hardware-in-nagios-on-the-debian-etch-64bit-platform/index.html#comments">No Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2009/01/monitor-it-with-nagios-fix-it-with-cfengine/index.html" rel="bookmark" title="Permanent Link to Monitor it with nagios, fix it with cfengine.">Monitor it with nagios, fix it with cfengine.</a></h2>



<div class="post-info">Posted January 22, 2009 by morten</div>

			   

			   <p>This is something we started doing some time during the end of last year. We wanted to have nagios and cfengine to cooperate. We didn&#8217;t want cfengine to monitor if processes were running, cause thats nagios&#8217; job and we didnt want nagios to fix problems occuring, cause that&#8217;s cfengine&#8217;s job &#8230;.SO ..we found out that cfrun could help us out with this problem and make a simple integration. Here&#8217;s how we did it.</p>
<p>In this particular scenario, we had some segfaults in our apache logs caused by some PHP errors we couldnt fix, which ended up in apache spawning a lot of child processes and giving us lots of defuncts and we had to restart apache every now and then.</p>
<p>So first we configured a check in our services config file in nagios. Something like this :</p>
<p><strong>services.cfg</strong></p>
<p><code>define service{<br />
use generic-service<br />
host_name webserver.somedomain.com<br />
service_description CHECK_LOG_SEGFAULT<br />
is_volatile 0<br />
max_check_attempts 1<br />
normal_check_interval 5<br />
retry_check_interval 1<br />
contact_groups admins<br />
notification_period 24x7<br />
notification_options c,w,r<br />
process_perf_data 1<br />
check_command check_log_segfault<br />
event_handler restart-apache<br />
}</code></p>
<p>Now configure the commands. One command for the event-handler,n ame it &#8220;restart-apache&#8221; which is what the &#8220;event_handler&#8221; option in the example above says. One command for the logcheck, &#8220;check_command check_log_segfault&#8221;</p>
<p><strong>commands.cfg : </strong></p>
<p><code>define command{<br />
command_name  restart-apache<br />
command_line  /usr/bin/sudo /usr/sbin/cfrun $HOSTNAME$ -T -- -q -D restart_apache2_now<br />
}<br />
define command{<br />
        command_name    check_log_segfault<br />
        command_line    $USER1$/check_by_ssh -l root -t 30 -H $HOSTADDRESS$ -C "/usr/lib/nagios/plugins/check_log -F /var/log/apache2/error.log -O /var/log/apache2/check_log_oldlog -q Segmentation"<br />
}<br />
</code><br />
(The check_log command is being run on every host that needs it, but you could for instance call it via net-snmp&#8217;s EXEC function if you dont want to use ssh. NRPE is prolly also an alternative).<br />
Be sure to enable eventhandlers in nagios.cfg for this to work.</p>
<p><strong>nagios.cfg :</strong></p>
<p><code>enable_event_handlers=1</code></p>
<p>Thats what&#8217;s needed for nagios. Let&#8217;s conf some cfengine.</p>
<p>In the nagios config you can see we&#8217;re running the cfengine class &#8220;restart_apache2_now&#8221;, so lets create a cfengine class with the same name.</p>
<p><strong>cf.apache2 : </strong><br />
<code><br />
###############################################################<br />
control:<br />
actionsequence = ( packages shellcommands )<br />
AddInstallable = ( has_apache2 )<br />
IfElapsed = ( 0 )<br />
###############################################################<br />
classes:<br />
###############################################################<br />
packages:<br />
debian::<br />
apache2<br />
pkgmgr=dpkg<br />
define=has_apache2<br />
################################################################<br />
shellcommands:<br />
# apache2 initscript<br />
# Usage: /etc/init.d/apache2 {start|stop|restart|reload|force-reload}<br />
debian.has_apache2.restart_apache2_now::<br />
"/etc/init.d/apache2 restart"</code></p>
<p>Be sure to include this class in your cfengine config so that cfengine knows about it.</p>
<p>So now nagios monitors the logfile, checks for segfault messages and tells cfengine to restart apache if a segfault is found. (The nagios plugin check_log takes care of comparing new and old segfault messages, so that&#8217;s nothing to worry about). Everyone is happy and we (the sysadmins) dont have to do shit. Just the way we want it.</p>



<p>Tags: <a href="../../../apache/index.html" rel="tag">apache</a>, <a href="../../../cfengine/index.html" rel="tag">cfengine</a>, <a href="../../../cfrun/index.html" rel="tag">cfrun</a>, <a href="../../index.html" rel="tag">nagios</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2009/01/monitor-it-with-nagios-fix-it-with-cfengine/index.html#comments">No Comments</a></div>

			  

			   

			   <!-- End Post -->



	 

				<!-- Start Post -->

		 

		       <div class="post">

			   

			   <h2><a href="../../../../2008/10/monitoring-videostreams-with-nagios/index.html" rel="bookmark" title="Permanent Link to Monitoring videostreams with Nagios">Monitoring videostreams with Nagios</a></h2>



<div class="post-info">Posted October 8, 2008 by morten</div>

			   

			   <p>Recently I wanted to monitor a streamingservice via <a title="Nagios" href="http://www.nagios.org/" target="_blank">Nagios</a> and started thinking about how it could be done on the commandline so it could easily be monitored without doing silly gui stuff. Came to think of <a title="mplayer" href="http://www.mplayerhq.hu/design7/news.html" target="_blank">mplayer</a> and its ability to play streams ..and so I started playing with it for a bit.</p>
<p>Running the command : <code>mplayer -noframedrop -quiet -dumpstream "http://someurl" -dumpfile "some_local_dumpfile"</code> does everything i need. It streams the video and dumps it in a local file. This means you can assume that the stream is working if your dumped file is the right size. To find the size, just simply dump the video one time, check its size and use the size as a parameter to the nagios plugin.</p>
<p>Here’s the plugin. Feel free to copy &amp; paste it and use it for your own monitoring.<br />
You will ofcourse have to have <a title="mplayer" href="http://www.mplayerhq.hu/design7/news.html" target="_blank">mplayer</a> installed.</p>
<p><code>#!/usr/bin/perl -w<br />
# This check uses mplayer to dump a videostream, check the size of it<br />
# and determine if the streaming service is working or not.<br />
# ...uh ...yeah :-)<br />
#morten bekkelund 2008<br />
<br />
use Getopt::Long;<br />
use File::stat;<br />
<br />
my %ERRORS=('OK'=&gt;0,'WARNING'=&gt;1,'CRITICAL'=&gt;2,'UNKNOWN'=&gt;3,'DEPENDENT'=&gt;4);<br />
<br />
sub print_usage {<br />
print "Usage: check_xstream -u &lt;url&gt; -d &lt;dumped stream filename&gt; -s &lt;expected size of dumped file&gt; \n";<br />
print "Example: ./check_xstream -u mms://streamserver/stream -d /tmp/dump -s 4533646 \n";<br />
}<br />
<br />
sub help {<br />
print_usage();<br />
}<br />
<br />
Getopt::Long::Configure ("bundling");<br />
GetOptions(<br />
'u:s'   =&gt; \$url,                  'url'                =&gt; \$url,<br />
'd:s'   =&gt; \$dump,                 'dump'               =&gt; \$dump,<br />
's:i'     =&gt; \$expected_size,        'size'             =&gt; \$expected_size<br />
);<br />
<br />
if(!$url or !$expected_size or !$dump) {<br />
print_usage();<br />
exit $ERRORS{"UNKNOWN"};<br />
}<br />
<br />
unlink($dump);<br />
my $check_stream=`/usr/bin/mplayer -noframedrop -quiet -dumpstream "$url" -dumpfile "$dump" 2&gt;&amp;1`;<br />
my $file_size=stat("$dump")-&gt;size;<br />
<br />
if(!$file_size) {<br />
print "UNKNOWN: Cannot find dumped stream.\n";<br />
exit $ERRORS{"UNKNOWN"};<br />
}<br />
<br />
if($file_size != $expected_size) {<br />
print "CRITICAL: The size of the stream diffs from the expected size. Streaming doesnt appear to work correctly.\n";<br />
exit $ERRORS{"CRITICAL"};<br />
}<br />
<br />
if($file_size == $expected_size) {<br />
print "OK: The size of the stream is correct. Streaming appears to work correctly.\n";<br />
exit $ERRORS{"OK"};<br />
}<br />
<br />
print "UNKNOWN: Something really fishy is going on here....\n";<br />
exit $ERRORS{"UNKNOWN"};<br />
# end</code></p>
<p>You can call the script check_stream or whatever you prefer and put it in your nagios plugins directory.</p>
<p>Configure commands.cfg for the new plugin :<br />
<code>define command{<br />
command_name    check_stream<br />
command_line    $USER1$/check_stream -u "$ARG1$" -s "$ARG2$" -d "$ARG3$"<br />
}<br />
</code></p>
<p>and finally configure your services file to something like this :</p>
<p><code>define service{<br />
use                             generic-service<br />
host_name                       yourhost<br />
service_description             CHECK_STREAM<br />
is_volatile                     0<br />
max_check_attempts              3<br />
normal_check_interval           5<br />
retry_check_interval            1<br />
contact_groups                  yourcontacts<br />
notification_period             24x7<br />
notification_options            c,w,r<br />
process_perf_data               1<br />
check_command                   check_stream!"mms://someurl"!expected_dump_size!"/tmp/streamdump"<br />
}</code></p>



<p>Tags: <a href="../../../mms/index.html" rel="tag">mms</a>, <a href="../../../monitoring/index.html" rel="tag">monitoring</a>, <a href="../../index.html" rel="tag">nagios</a>, <a href="../../../stream/index.html" rel="tag">stream</a>, <a href="../../../video/index.html" rel="tag">video</a></p>
			   

			   </div>

			   

			   <div class="info-box"><a href="../../../../2008/10/monitoring-videostreams-with-nagios/index.html#comments">2 Comments</a></div>

			  

			   

			   <!-- End Post -->






<div class="clear">

<div class="alignleft"></div>

			<div class="alignright"><a href="../../index.html" >Newer Entries &raquo;</a></div>

</div>



		   

		 

		 </div>

		 <!-- End Content -->

		 

		 <!-- Begin Sidebar -->
		 <div id="sidebar">

<div class="sidebar-item"><div class="sidebar-heading"><h3>Tags</h3></div><div class="sidebar-content"><div class="tagcloud"><a href='../../../apache/index.html' class='tag-link-35' title='3 topics' style='font-size: 10.153846153846pt;'>apache</a>
<a href='../../../apple/index.html' class='tag-link-74' title='4 topics' style='font-size: 11.948717948718pt;'>apple</a>
<a href='../../../appletv/index.html' class='tag-link-257' title='3 topics' style='font-size: 10.153846153846pt;'>appletv</a>
<a href='../../../atv/index.html' class='tag-link-266' title='3 topics' style='font-size: 10.153846153846pt;'>atv</a>
<a href='../../../authentication/index.html' class='tag-link-111' title='2 topics' style='font-size: 8pt;'>authentication</a>
<a href='../../../bigip/index.html' class='tag-link-234' title='3 topics' style='font-size: 10.153846153846pt;'>bigip</a>
<a href='../../../broadcom/index.html' class='tag-link-255' title='3 topics' style='font-size: 10.153846153846pt;'>broadcom</a>
<a href='../../../cfengine/index.html' class='tag-link-144' title='2 topics' style='font-size: 8pt;'>cfengine</a>
<a href='../../../check_http/index.html' class='tag-link-166' title='2 topics' style='font-size: 8pt;'>check_http</a>
<a href='../../../crystal/index.html' class='tag-link-263' title='4 topics' style='font-size: 11.948717948718pt;'>crystal</a>
<a href='../../../crystalhd/index.html' class='tag-link-259' title='4 topics' style='font-size: 11.948717948718pt;'>crystalhd</a>
<a href='../../../curl/index.html' class='tag-link-67' title='2 topics' style='font-size: 8pt;'>curl</a>
<a href='../../../dd/index.html' class='tag-link-17' title='2 topics' style='font-size: 8pt;'>dd</a>
<a href='../../../debian/index.html' class='tag-link-4' title='8 topics' style='font-size: 16.435897435897pt;'>debian</a>
<a href='../../../dell/index.html' class='tag-link-138' title='4 topics' style='font-size: 11.948717948718pt;'>dell</a>
<a href='../../../etch/index.html' class='tag-link-210' title='3 topics' style='font-size: 10.153846153846pt;'>etch</a>
<a href='../../../ext3/index.html' class='tag-link-12' title='2 topics' style='font-size: 8pt;'>ext3</a>
<a href='../../../firefox/index.html' class='tag-link-167' title='4 topics' style='font-size: 11.948717948718pt;'>firefox</a>
<a href='../../../firefuck/index.html' class='tag-link-208' title='3 topics' style='font-size: 10.153846153846pt;'>firefuck</a>
<a href='../../../funny/index.html' class='tag-link-182' title='4 topics' style='font-size: 11.948717948718pt;'>funny</a>
<a href='../../../hd/index.html' class='tag-link-264' title='4 topics' style='font-size: 11.948717948718pt;'>hd</a>
<a href='../../../iphone/index.html' class='tag-link-75' title='3 topics' style='font-size: 10.153846153846pt;'>iphone</a>
<a href='../../../kernel/index.html' class='tag-link-73' title='2 topics' style='font-size: 8pt;'>kernel</a>
<a href='../../../linux/index.html' class='tag-link-72' title='10 topics' style='font-size: 18.051282051282pt;'>linux</a>
<a href='../../../login/index.html' class='tag-link-150' title='2 topics' style='font-size: 8pt;'>login</a>
<a href='../../../monitoring/index.html' class='tag-link-29' title='11 topics' style='font-size: 18.769230769231pt;'>monitoring</a>
<a href='../../../mplayer/index.html' class='tag-link-55' title='3 topics' style='font-size: 10.153846153846pt;'>mplayer</a>
<a href='../../../mysql/index.html' class='tag-link-88' title='3 topics' style='font-size: 10.153846153846pt;'>mysql</a>
<a href='../../index.html' class='tag-link-25' title='17 topics' style='font-size: 22pt;'>nagios</a>
<a href='../../../network/index.html' class='tag-link-94' title='2 topics' style='font-size: 8pt;'>network</a>
<a href='../../../osx/index.html' class='tag-link-163' title='3 topics' style='font-size: 10.153846153846pt;'>osx</a>
<a href='../../../ping/index.html' class='tag-link-81' title='3 topics' style='font-size: 10.153846153846pt;'>ping</a>
<a href='../../../plugins/index.html' class='tag-link-165' title='3 topics' style='font-size: 10.153846153846pt;'>plugins</a>
<a href='../../../rar/index.html' class='tag-link-57' title='2 topics' style='font-size: 8pt;'>rar</a>
<a href='../../../salt/index.html' class='tag-link-316' title='3 topics' style='font-size: 10.153846153846pt;'>salt</a>
<a href='../../../saltstack/index.html' class='tag-link-317' title='3 topics' style='font-size: 10.153846153846pt;'>saltstack</a>
<a href='../../../sarge/index.html' class='tag-link-113' title='2 topics' style='font-size: 8pt;'>sarge</a>
<a href='../../../slow/index.html' class='tag-link-158' title='2 topics' style='font-size: 8pt;'>slow</a>
<a href='../../../ssh/index.html' class='tag-link-109' title='2 topics' style='font-size: 8pt;'>ssh</a>
<a href='../../../tv/index.html' class='tag-link-271' title='3 topics' style='font-size: 10.153846153846pt;'>tv</a>
<a href='../../../ubuntu/index.html' class='tag-link-173' title='6 topics' style='font-size: 14.641025641026pt;'>ubuntu</a>
<a href='../../../varnish/index.html' class='tag-link-31' title='4 topics' style='font-size: 11.948717948718pt;'>varnish</a>
<a href='../../../video/index.html' class='tag-link-27' title='2 topics' style='font-size: 8pt;'>video</a>
<a href='../../../xbmc/index.html' class='tag-link-256' title='3 topics' style='font-size: 10.153846153846pt;'>xbmc</a>
<a href='../../../xen/index.html' class='tag-link-39' title='4 topics' style='font-size: 11.948717948718pt;'>xen</a></div>
</div></div><div class="sidebar-item"><div class="sidebar-heading"><h3>Links</h3></div><div class="sidebar-content">
	<ul class='xoxo blogroll'>
<li><a href="http://www.debian.org/" title="Debian">Debian</a></li>
<li><a href="http://www.usenix.org/lisa08/going" title="We are going to LISA &#8217;08">LISA &#8217;08</a></li>
<li><a href="http://marcus.nordaaker.com/" title="marcus ramberg">marcus ramberg</a></li>

	</ul>
</div></div>
<!-- WP Wall -->
<div class="sidebar-item"><div class="sidebar-heading"><h3>Wall</h3></div><div class="sidebar-content">
<div id="wp_wall">
		<div class="wallnav">
					<img alt="Previous" id="img_left" src="../../../../wp-content/plugins/wp-wall/i/left.png" />
					<img alt="Next" id="img_right" src="../../../../wp-content/plugins/wp-wall/i/right.png" />
					  </div> 
	<div id="wallcomments">
			<div id="wp_latest">Latest on Thu, 04:38 pm</div><p class="wall-1 "><span class="wallauthor" title="Iliya#ivanov[IvanovRukidssqu,2,5] on 2020-07-02 16:38:51" >Iliya#ivanov[IvanovRukidssqu,2,5]</span><span class="wallcomment" title="Мое почтение. 
Располагаю кредитная карта в Гранит банк на сумму 195000 
Перестал гасить потому что украли деньги. Нынче трезвонят и пугают и просят возвратить 1400 
 
Установил софт  запрет входящих вызовов наборы остановились. 
Что совершать с займом дальше предложите?" >: Мое почтение. 
Располагаю кредитная карта в Гранит банк на сумму 195000 
Перестал гасить потому что украли деньги. Нынче трезвонят и пугают и просят возвратить 1400 [...]</span></p><p class="wall-2 wall-alt "><span class="wallauthor" title="Colton Ward on 2020-04-14 09:12:09" >Colton Ward</span><span class="wallcomment" title="Bought a groupon for botox and filler. Waited for 
over two hours for my procedure. During the consultation I 
clearly explained to the woman that I did not want to purchase 
any more products and spend more money and just wanted to 
try out the cosmetic procedures I had purchased which was already $300.



Once I was finally seen by the \   https://gome.com.cn" >: Bought a groupon for botox and filler. Waited for 
over two hours for my procedure. During the consultation I 
clearly explained to the woman that [...]</span></p><p class="wall-3 "><span class="wallauthor" title="eticobysu on 2020-01-27 23:11:02" >eticobysu</span><span class="wallcomment" title="kategoriyab.ru" >: kategoriyab.ru</span></p><p class="wall-4 wall-alt "><span class="wallauthor" title="txcyperoz61 on 2019-12-17 21:41:07" >txcyperoz61</span><span class="wallcomment" title="Огромное тебе СПАСИБО" >: Огромное тебе СПАСИБО</span></p><p class="wall-5 "><span class="wallauthor" title="Dallas on 2019-10-30 06:16:11" >Dallas</span><span class="wallcomment" title="Thanks in support of sharing such a pleasant idea, article is fastidious, thats why i have read it entirely
weight loss doctors chicago phentermine
weight loss doctors chicago phentermine weight loss doctors chicago phentermine" >: Thanks in support of sharing such a pleasant idea, article is fastidious, thats why i have read it entirely
weight loss doctors chicago phentermine
weight loss doctors [...]</span></p><input type="hidden" name="wallpage" id="wallpage" value="1" /><input type="hidden" name="page_left" id="page_left" value="1" /><input type="hidden" name="page_right" id="page_right" value="2" />	</div> 

	
	
		
					
			<p><a id="wall_post_toggle"> &raquo; Leave a reply</a></p>	
		
				
	

	<div id="wall_post">
		<form action="http://dingleberry.me/wp-content/plugins/wp-wall/wp-wall-ajax.php" method="post" id="wallform">
		
						
			<p>
			<label for="wpwall_author"><small>Name</small></label><br/>
			<input type="text" name="wpwall_author" id="wpwall_author" value=""  tabindex="11"  />
			</p>
			
						
						
			<p>
			<label for="wpwall_comment"><small>Comment</small></label><br/>
			<textarea name="wpwall_comment" id="wpwall_comment" rows="3" cols="" tabindex="13" ></textarea>
			</p>
					
			<p><input name="submit_wall_post" type="submit" id="submit_wall_post" tabindex="14" value="Submit" /></p>
			
		</form> 								
	</div>
	
	<div id="wallresponse"></div>
	
</div>
<br />
</div></div><div class="sidebar-item"><div class="sidebar-heading"><h3>Meta</h3></div><div class="sidebar-content">			<ul>
						<li><a href="../../../../wp-login.html">Log in</a></li>
			<li><a href="../../../../feed/index.html" title="Syndicate this site using RSS 2.0">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="../../../../comments/feed/index.html" title="The latest comments to all posts in RSS">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>						</ul>
</div></div><div class="sidebar-item">	          	 <div class="sidebar-item">
				 <div class="sidebar-heading"><h3>Search</h3></div>
				 <div class="sidebar-content">
<form method="get" id="searchform" action="http://dingleberry.me/">
<div><input type="text" value="" name="s" id="s" />
<input type="submit" id="searchsubmit" value="" />
</div>
</form>
				</div>
				</div></div></div>

		 </div>
		 <!-- End Sidebar -->
<div id="footer">

Copyright &copy; 2008.  Design by <a href="http://imanto.com/">imanto.com</a>.  Theme by <a href="http://www.themelab.com/">Theme Lab</a> and <a href="http://www.websiteoffice.com/">Online Marketing</a>.  Powered by <a href="http://wordpress.org/">WordPress</a>.

33 queries in 0.185  seconds.

   </div>

   <!-- End Wrapper -->

<script type='text/javascript' src='../../../../wp-content/uploads/shadowbox-js/afc2df7514bde3dd091bff35b266117519ce.js?ver=3.0.3'></script>

<!-- Begin Shadowbox JS v3.0.3.10 -->
<!-- Selected Players: html, iframe, img, qt, swf, wmp -->
<script type="text/javascript">
/* <![CDATA[ */
	var shadowbox_conf = {
		animate: true,
		animateFade: true,
		animSequence: "sync",
		modal: false,
		showOverlay: true,
		overlayColor: "#000",
		overlayOpacity: "0.8",
		flashBgColor: "#000000",
		autoplayMovies: true,
		showMovieControls: true,
		slideshowDelay: "0",
		resizeDuration: "0.35",
		fadeDuration: "0.35",
		displayNav: true,
		continuous: false,
		displayCounter: true,
		counterType: "default",
		counterLimit: "10",
		viewportPadding: "20",
		handleOversize: "resize",
		handleUnsupported: "link",
		autoDimensions: false,
		initialHeight: "160",
		initialWidth: "320",
		enableKeys: true,
		skipSetup: false,
		flashParams: {bgcolor:"#000000", allowFullScreen:true},
		flashVars: {},
		flashVersion: "9.0.0",
		useSizzle: false
	};
	Shadowbox.init(shadowbox_conf);
/* ]]> */
</script>
<!-- End Shadowbox JS -->


<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5928000-1");
pageTracker._trackPageview();
</script>

</body>


<!-- Mirrored from dingleberry.me/tag/nagios/page/2/ by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 28 Jul 2020 09:31:34 GMT -->
</html>